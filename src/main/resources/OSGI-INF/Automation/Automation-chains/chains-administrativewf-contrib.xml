<?xml version="1.0" encoding="UTF-8"?>

<component name="org.athento.nuxeo.athento-nx-administrative-doctypes.chains-administrativewf"
    version="1.0.0">
    <require>org.nuxeo.runtime.started</require>

    <extension target="org.nuxeo.ecm.core.operation.OperationServiceComponent"
        point="chains">

        <chain id="administrativewf-calculateHierarchy">
            <documentation>
            </documentation>
            <operation id="Context.FetchDocument" />
            <operation id="Context.SetVar">
                <param type="string" name="name">len</param>
                <param type="object" name="value">expr:Document["userFile:office"] == empty ? "0" :
                    Document["userFile:office"].length()
                </param>
            </operation>
            <operation id="Context.SetVar">
                <param type="string" name="name">office_var</param>
                <param type="object" name="value">expr:len == 2 ?
                    Fn.getVocabularyLabel("officenat",Document["userFile:office"]) :
                    Document["userFile:office"]
                </param>
            </operation>
            <operation id="Context.SetVar">
                <param type="string" name="name">isRME_var</param>
                <param type="object" name="value">expr:office_var == "0529" ?
                    true : office_var == "0354" ?
                    true : office_var == "0475" ?
                    true : false
                </param>
            </operation>
            <operation id="Context.SetVar">
                <param type="string" name="name">isCentral_var</param>
                <param type="object" name="value">expr:office_var == "0509" ?
                    true : office_var == "0519" ?
                    true : false
                </param>
            </operation>
            <operation id="Context.SetVar">
                <param type="string" name="name">needslocalapproval_var</param>
                <param type="object" name="value">expr:Document["administrative:needslocalapproval"]
                </param>
            </operation>
            <operation id="Context.SetVar">
                <param type="string" name="name">sector_var</param>
                <param type="object" name="value">expr:Document["administrative:sector"]
                </param>
            </operation>
            <operation id="Context.SetVar">
                <param type="string" name="name">RME_VO</param>
                <param type="object" name="value">expr:@{"group:RME_VO"}
                </param>
            </operation>
            <operation id="Context.SetVar">
                <param type="string" name="name">DIST_VN</param>
                <param type="object" name="value">expr:@{"group:DIST_VN"}
                </param>
            </operation>
            <operation id="Context.SetVar">
                <param type="string" name="name">RME_VN</param>
                <param type="object" name="value">expr:@{"group:RME_VN"}
                </param>
            </operation>
            <operation id="Context.SetVar">
                <param type="string" name="name">SSCC_WF</param>
                <param type="object" name="value">expr:@{"group:SSCC_WF"}
                </param>
            </operation>
            <operation id="Context.SetVar">
                <param type="string" name="name">RRHH_WF</param>
                <param type="object" name="value">expr:@{"group:RRHH_WF"}
                </param>
            </operation>
            <operation id="Context.SetVar">
                <param type="string" name="name">MK_WF</param>
                <param type="object" name="value">expr:@{"group:MK_WF"}
                </param>
            </operation>
            <operation id="Context.SetVar">
                <param type="string" name="name">level25</param>
                <param type="object" name="value">expr:@{"group:Level25_"+office_var}
                </param>
            </operation>
            <operation id="Context.SetWorkflowVar">
                <param type="string" name="name">level25office</param>
                <param type="object" name="value">expr:isRME_var ?
                    (sector_var == '00' ? RME_VN :
                    sector_var == '01' ? RME_VO : RME_VO) :
                    isCentral_var ?
                    (sector_var == '00' ? DIST_VN :
                    sector_var == '05' ? RRHH_WF :
                    sector_var == '06' ? MK_WF : level25) :
                    level25
                </param>
            </operation>
            <operation id="Context.SetWorkflowVar">
                <param type="string" name="name">needslocalapproval</param>
                <param type="object" name="value">expr:needslocalapproval_var
                </param>
            </operation>
            <operation id="Context.SetWorkflowVar">
                <param type="string" name="name">level18</param>
                <param type="object" name="value">expr:@{"group:Level18"}
                </param>
            </operation>
        </chain>

    </extension>

</component>