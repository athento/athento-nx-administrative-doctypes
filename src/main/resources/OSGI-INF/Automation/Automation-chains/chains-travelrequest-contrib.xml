<?xml version="1.0" encoding="UTF-8"?>

<component name="org.athento.nuxeo.athento-nx-administrative-doctypes.chains-travelrequest"
           version="1.0.0">
    <require>org.nuxeo.runtime.started</require>

    <extension target="org.nuxeo.ecm.core.operation.OperationServiceComponent"
               point="chains">

        <chain id="calculateTravelRequestCompany">
            <documentation>
                Company to invoice depending on the center attached.
            </documentation>
            <operation id="Context.FetchDocument" />
            <operation id="Context.SetVar">
                <param type="string" name="name">company_var</param>
                <param type="object" name="value">expr:Document["administrative:travel_office"].charAt(0) == '0' ? '01 Renault Retail Group Madrid' :
                                                Document["administrative:travel_office"].charAt(0) == '1' ? '01 Renault Retail Group Madrid' :
                                                Document["administrative:travel_office"].charAt(0) == '2' ? '01 Renault Retail Group Madrid' :
                                                Document["administrative:travel_office"].charAt(0) == '5' ? '50 Renault Retail Group Barcelona' :
                                                '70 Renault Retail Group Levante'
                </param>
            </operation>
            <operation id="Document.SetProperty">
                <param type="string" name="xpath">administrative:travel_companyNumber</param>
                <param type="boolean" name="save">false</param>
                <param type="serializable" name="value">expr:company_var
                </param>
            </operation>
        </chain>
        <chain id="Renault.OM-EnviarEmailConAdjuntos">
            <operation id="Context.FetchDocument" />
            <operation id="Context.SetVar">
                <param type="string" name="name">email_var</param>
                <param type="object" name="value">expr:Fn.getVocabularyLabel("config-om","email-OM")
                </param>
            </operation>
            <operation id="Context.SetVar">
                <param type="string" name="name">from_var</param>
                <param type="object" name="value">expr:Fn.getVocabularyLabel("config-om","from-OM")
                </param>
            </operation>
            <operation id="Context.SetVar">
                <param type="string" name="name">message_var</param>
                <param type="object" name="value">expr:Fn.getVocabularyLabel("config-om","message-OM")
                </param>
            </operation>
            <operation id="Context.SetVar">
                <param type="string" name="name">subject_var</param>
                <param type="object" name="value">expr:Fn.getVocabularyLabel("config-om","subject-OM")
                </param>
            </operation>
            <operation id="Document.Mail">
                <param type="string" name="from">expr:from_var</param>
                <param type="string" name="message">expr:message_var</param>
                <param type="string" name="subject">expr:subject_var</param>
                <param type="string" name="to">expr:email_var</param>
                <param type="stringlist" name="files">file:content</param>
            </operation>
        </chain>

    </extension>

</component>